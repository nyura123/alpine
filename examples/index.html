<html>
    <head>
        <style>
            .hidden { display: none; }
            [x-cloak] { display: none; }
            .opacity-0 { opacity: 0; }
            .opacity-100 { opacity: 1; }
            .transition-slow { transition-duration: 300ms; }
            .transition-medium { transition-duration: 200ms; }
            .transition-faster { transition-duration: 100ms; }
            .scale-90 { transform: scale(0.9); }
            .scale-100 { transform: scale(1); }
            .ease-in { transition-timing-function: cubic-bezier(0.4, 0, 1, 1); }
            .ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }
            .border {
                border: 1px solid gray;
            }
            .border-b-2 {
                border-bottom: 2px solid gray;
            }
            .rounded-sm {
                border-radius: 3px;
            }
            .py-2 {
                padding-top: 2px;
                padding-bottom: 2px;
            }
            .px-3 {
                padding-left: 3px;
                padding-left: 3px;
            }
            .flex {
                display: flex
            }
            .flex-col {
                flex-direction: column;
            }
            .justify-start {
                justify-content: flex-start;
            }
            .justify-between {
                justify-content: space-between;
            }
        </style>

        <script src="/dist/alpine.js" defer></script>
    </head>
    <body>
        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Demo</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Simple x-if</td>
                    <td>
                        <div x-data="{ show: false }">
                            <template x-if="show">
                                <span>hey</span>
                            </template>

                            <button @click="show = ! show">Show</button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Dropdown</td>
                    <td>
                        <div x-data="{ open: false }">
                            <button x-on:click="open= true">Open Dropdown</button>
                            <ul
                                x-bind:class="{ 'hidden': ! open }"
                                x-on:click.away="open= false"
                                x-cloak>
                                Dropdown Body
                            </ul>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Tabs</td>
                    <td>
                        <div x-data="{ currentTab: 'tab1' }">
                            <button x-bind:class="{ 'active': currentTab ===
                                'tab1' }" x-on:click="currentTab= 'tab1'">Foo</button>
                            <button x-bind:class="{ 'active': currentTab ===
                                'tab2' }" x-on:click="currentTab= 'tab2'">Bar</button>
                            <div x-bind:class="{ 'hidden': currentTab !== 'tab1'
                                }">Tab Foo</div>
                            <div class="hidden" x-bind:class="{ 'hidden':
                                currentTab !== 'tab2' }">Tab Bar</div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Data Binding</td>
                    <td>
                        <div x-data="{ text: 'foo', checkbox: ['foo'], radio:
                            'foo', select: 'foo', 'multiselect': ['foo'] }">
                            Text:
                            <span x-text="JSON.stringify(text)"></span>
                            <input type="text" x-model="text">
                            Checkbox:
                            <span x-text="JSON.stringify(checkbox)"></span>
                            <input type="checkbox" x-model="checkbox"
                                value="foo">
                            <input type="checkbox" x-model="checkbox"
                                value="bar">
                            Radio:
                            <span x-text="JSON.stringify(radio)"></span>
                            <input type="radio" x-model="radio" value="foo">
                            <input type="radio" x-model="radio" value="bar">
                            Select:
                            <span x-text="JSON.stringify(select)"></span>
                            <select x-model="select">
                                <option>foo</option>
                                <option>bar</option>
                            </select>
                            Multiple Select:
                            <span x-text="JSON.stringify(multiselect)"></span>
                            <select x-model="multiselect" multiple>
                                <option>foo</option>
                                <option>bar</option>
                            </select>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Cast to number</td>
                    <td>
                        <div x-data="{ number: 1 }">
                            <div x-text="JSON.stringify($data.number)"></div>
                            <input type="text" x-model.number="number">
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Nested Binding</td>
                    <td>
                        <div x-data="{ foo: { bar: 'baz' } }">
                            <div x-text="foo.bar"></div>
                            <input type="text" x-model="foo.bar">
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>On Click</td>
                    <td>
                        <div x-data="{ show: false }">
                            <div x-show="show">Hi There!</div>

                            <button x-on:click="show= ! show">Show/Hide</button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Refs</td>
                    <td>
                        <div x-data="{ someText: 'bar' }">
                            <div x-ref="remove-target">Remove Me</div>

                            <button
                                x-on:click="$refs['remove-target'].remove()">Remove</button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>x-on:click.stop</td>
                    <td>
                        <div x-data="{ someText: 'bar' }">
                            <span x-text="someText"></span>

                            <div x-on:click="someText= 'baz'">
                                <button x-on:click.stop>Shouldn't change to baz</button>
                            </div>

                        </div>
                    </td>
                </tr>

                <tr>
                    <td>x-on:click.prevent</td>
                    <td>
                        <div x-data="{}">
                            <a href="https://google.com" x-on:click.prevent>Shouldn't
                                go to Google</a>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>x-on:click.once</td>
                    <td>
                        <div x-data="{ count: 0 }">
                            <button x-on:click.once="count++">I've been clicked:
                                <span x-text="count"></span></button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Append DOM</td>
                    <td>
                        <div id="goHere">Click me.</div>
                        <script>
                            const thing = document.querySelector('#goHere')
                            const handler = (e) => {
                                thing.removeEventListener('click', handler)

                                const div = document.createElement('div')
                                div.setAttribute('x-data', '{hey: "there"}')
                                div.innerHTML = '<input type="text" x-model="hey"><h1 x-text="hey"></h1>'
                                e.target.appendChild(div)
                            }

                            var listener = thing.addEventListener('click', handler)
                        </script>
                    </td>
                </tr>

                <tr>
                    <td>Append Nested DOM</td>
                    <td>
                        <div id="goHere2">Click me.</div>
                        <script>
                            const thing2 = document.querySelector('#goHere2')
                            const handler2 = (e) => {
                                thing2.removeEventListener('click', handler2)

                                e.target.innerHTML = `
                                    <article>
                                        <div x-data="{hey: 'there'}">
                                            <input type="text" x-model="hey"><h1 x-text="hey"></h1>
                                        </div>
                                    </article>
                                `
                            }

                            var listener = thing2.addEventListener('click', handler2)
                        </script>
                    </td>
                </tr>

                <tr>
                    <td>Component with Props</td>
                    <td>
                        <div
                            x-data="{stateFromProp1: $props.prop1}"
                            x-props="{prop1: 'SomeVal'}"
                        >
                            <div>
                                state from prop:&nbsp;
                                <b><span x-text="stateFromProp1"></span></b>
                            </div>
                            <div>
                                prop:&nbsp;<b
                                    ><span x-text="$props.prop1"></span
                                ></b>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Nested Components with Props</td>
                    <td>
                        <div x-data="{ foo: { bar: 'baz' } }">
                            Parent Component: <input type="text" x-model="foo.bar" />
                            <div
                                x-data="componentWithProps($props)"
                                x-props="{prop1: foo.bar}"
                            >
                            <p></p>
                                Nested Component: 
                                <div>
                                    &nbsp;Initial prop:
                                    <span x-text="stateFromProp1"></span>
                                </div>
                                <div>
                                    &nbsp;latest prop:
                                    <span x-text="$props.prop1"></span>
                                </div>
                            </div>
                            <script>
                                function componentWithProps(initialProps) {
                                    return {
                                        stateFromProp1: initialProps.prop1
                                    }
                                }
                            </script>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>x-for</td>
                    <td>
                        <div x-data="{ items: ['foo', 'bar'], foo: 'bar' }">
                            <input type="checkbox" x-model="items" value="foo">
                            <input type="checkbox" x-model="items" value="bar">
                            <input type="checkbox" x-model="items" value="baz">

                            <button @click="items = ['bar', 'bob']">hey</button>

                            <template x-for="item in items" :key="item">
                                <div x-text="item" x-transition:enter-start="opacity-0 scale-90"
                                    x-transition:enter="ease-out transition-medium"
                                    x-transition:enter-end="opacity-100 scale-100"
                                    x-transition:leave-start="opacity-100 scale-100"
                                    x-transition:leave="ease-in transition-faster"
                                    x-transition:leave-end="opacity-0 scale-90"
                                ></div>
                            </template>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Nested x-for</td>
                    <td>
                        <div x-data="{ foos: [{bars: [{bobs: ['one', 'two']}, {bobs: ['three', 'four']}]}, {bars: [{bobs: ['five', 'six']}, {bobs: ['seven', 'eight']}]}] }">
                            <template x-for="foo in foos">
                                <div>
                                    <template x-for="bar in foo.bars">
                                        <div>
                                            <template x-for="bob in bar.bobs">
                                                <span x-text="bob"></span>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Transitions</td>
                    <td>
                        <div x-data="{ open: false }">
                            <button x-on:click="open= ! open">
                                Open Modal
                            </button>

                            <div x-show="open"
                                x-transition:enter="transition-medium"
                                x-transition:leave="transition-medium">
                                <div x-show="open"
                                    x-transition:enter="transition-medium"
                                    x-transition:enter-start="opacity-0"
                                    x-transition:leave-end="opacity-0"
                                    x-transition:leave="transition-medium"></div>
                                <div x-show="open"
                                    x-transition:enter-start="opacity-0 scale-90"
                                    x-transition:enter="ease-out transition-medium"
                                    x-transition:enter-end="opacity-100 scale-100"
                                    x-transition:leave-start="opacity-100 scale-100"
                                    x-transition:leave="ease-in transition-faster"
                                    x-transition:leave-end="opacity-0 scale-90">
                                    <div>
                                        hey
                                    </div>
                                    <div>
                                        <button x-on:click="open= false" type="button">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                
               
                <tr>
                    <td valign='top'>Accordion using prop callbacks</td>
                    <td valign='top'>
                        <div style="min-height:300px" class='flex flex-col justify-start' x-data="collapser('top', false)" x-init="init()">
                            <div class="flex justify-between border-b-2"><div>MENU</div><button x-on:click="toggle()">toggle</button></div>
                            <div x-bind:style="calcStyle()">
                                <div x-ref="child">
                                    <div>
                                        <div class="border-b-2">&nbsp;ITEM1</div>
                                        <div x-data="collapser('first', false)" x-init="init()" x-props="{updateParentHeight: updateHeightFromChild.bind($data)}">
                                            <div class="flex justify-between border-b-2"><div>&nbsp;SUBMENU</div><button x-on:click="toggle()">toggle</button></div>
                                            <div x-bind:style="calcStyle()">
                                                <div x-ref="child">
                                                    <div class="border-b-2">&nbsp;&nbsp;SUBMENU ITEM1</div>
                                                    <div x-data="collapser('second', false)" x-init="init()" x-props="{updateParentHeight: updateHeightFromChild.bind($data)}">
                                                        <div class="flex justify-between border-b-2"><div>&nbsp;&nbsp;SUB-SUBMENU_1</div><button x-on:click="toggle()">toggle</button></div>
                                                        <div x-bind:style="calcStyle()">
                                                            <div x-ref="child">
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUB-SUBMENU_1 ITEM1
                                                                </div>
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUB-SUBMENU_1 ITEM2
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="border-b-2">&nbsp;&nbsp;SUBMENU ITEM2</div>
                                                    <div class="border-b-2">&nbsp;&nbsp;SUBMENU ITEM3</div>
                                                    <div x-data="collapser('third', false)" x-init="init()" x-props="{updateParentHeight: updateHeightFromChild.bind($data)}">
                                                        <div class="flex justify-between border-b-2"><div>&nbsp;&nbsp;SUB-SUBMENU_2</div><button x-on:click="toggle()">toggle</button></div>
                                                        <div x-bind:style="calcStyle()">
                                                            <div x-ref="child">
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUB-SUBMENU_2 ITEM1
                                                                </div>
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUB-SUBMENU_2 ITEM2
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="border-b-2">
                                        &nbsp;ITEM2
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Dynamic accordion</td>
                    <td>
                        <div x-data="{items: [{name:'item1'},{name:'item2'}], includeSubMenu: ['yes'], itemToAdd: ''}">
                            <div>
                                <form x-on:click.prevent>
                                    <input x-model="itemToAdd" placeholder='type to add unique item...' /><br/>
                                    <label for='includeSubMenu'>Include Sub Menu?</label>
                                    <input id='includeSubMenu' type="checkbox" x-model="includeSubMenu" value="yes"><br/>
                                    <button type='submit' class='border rounded-sm py-2 px-3' x-bind:disabled="!itemToAdd" x-on:click="items = [{name: itemToAdd, includeSubMenu: includeSubMenu.length > 0}, ...items]; itemToAdd=''">Add</button>&nbsp;<br/>
                                </form>
                            </div>
                            <template x-for="(item, index) in items" :key="item">
                                <div>
                                    <div x-data="collapser($props.rowItem.name, false)" x-init="init()" x-props="{rowItem: item}">
                                        <div class="flex justify-between border-b-2"><div x-text="$props.rowItem.name"></div><button x-on:click="toggle()">toggle</button></div>
                                        <div x-bind:style="calcStyle()">
                                            <div x-ref="child">
                                                <div class="border-b-2">
                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUBITEM1
                                                </div>
                                                <div class="border-b-2">
                                                    &nbsp;&nbsp;&nbsp;&nbsp;SUBITEM2
                                                </div>
                                                <div x-bind:style="!$props.rowItem.includeSubMenu ? 'display:none': ''">
                                                    <div x-data="collapser($props.rowItem.name+'_sub', false)" x-init="init()" x-props="{rowItem: $props.rowItem, updateParentHeight: updateHeightFromChild.bind($data)}">
                                                        <div class="flex justify-between border-b-2"><div>&nbsp;&nbsp;&nbsp;&nbsp;SUBMENU</div><button x-on:click="toggle()">toggle</button></div>
                                                        <div x-bind:style="calcStyle()">
                                                            <div x-ref="child">
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBMENU ITEM1
                                                                </div>
                                                                <div class="border-b-2">
                                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBMENU ITEM2
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </td>
                </tr>
                <script>
                    const publishedHeights = new Map() // like React's refs
                    function collapser(name, initialExpanded=true) {
                        return {
                            name: name,
                            version: 1,
                            shouldTransition: false,
                            height: 0,
                            expanded: initialExpanded,
                            init() {
                                this.height = this.$refs.child.offsetHeight;
                                // relies on our *initial height* already being included in parent - do not publish on init,
                                // but consider it published
                                // this.publishHeightToParent();
                                publishedHeights[this.name] = this.height
                            },
                            toggle() {
                                this.expanded = !this.expanded
                                this.publishHeightToParent()
                            },
                            updateHeightFromChild(heightDelta, from) {
                            //   console.log(this.name, "height delta", `${this.height}+${heightDelta}`)
                              this.height += heightDelta;
                              this.publishHeightToParent()
                            },
                            publishHeightToParent() {
                                const publishedHeight = publishedHeights[this.name] || 0;
                                const newHeightToPublish = this.expanded ? this.height : 0;
                                // console.log(this.name, "publish ", newHeightToPublish, " was ", publishedHeight)
                                const func = this.$props && this.$props.updateParentHeight;
                                if (newHeightToPublish !== publishedHeight) {
                                    publishedHeight && func && func(-publishedHeight, this.name)
                                    newHeightToPublish && func && func(newHeightToPublish, this.name)
                                    publishedHeights[this.name] = newHeightToPublish
                                }
                            },
                            calcStyle() {
                                return `transition: all 300ms; max-height: ${(this.expanded ? this.height : '0')}px; overflow: hidden`
                            }
                        }
                    }
                </script>

                <tr>
                    <td>Transitions (with x-if)</td>
                    <td>
                        <div x-data="{ open: false }">
                            <button x-on:click="open= ! open">
                                Open Modal
                            </button>

                            <template x-if="open">
                                    <div x-transition:enter-start="opacity-0 scale-90"
                                    x-transition:enter="ease-out transition-medium"
                                    x-transition:enter-end="opacity-100 scale-100"
                                    x-transition:leave-start="opacity-100 scale-100"
                                    x-transition:leave="ease-in transition-faster"
                                    x-transition:leave-end="opacity-0 scale-90">
                                        hey
                                    </div>
                            </template>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Nested Transitions (with x-show)</td>
                    <td>
                        <div x-data="{ open: false }">
                            <button x-on:click="open= ! open">
                                Open Modal
                            </button>

                            <div x-show="open">
                                I shouldn't leave until the transition finishes.
                                <div x-show="open"
                                    x-transition:leave-start="opacity-100 scale-100"
                                    x-transition:leave="ease-in transition-slow"
                                    x-transition:leave-end="opacity-0 scale-90">
                                        I'm transitioning
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Init function callback access refs and mutate data</td>
                    <td>
                        <div x-data="initialData()" x-init="init()">
                            <div :style="'width: '+width+'px; background: purple;'">hey</div>

                            <button x-ref="inc">increase</button>
                        </div>

                        <script>
                            function initialData() {
                                return {
                                    width: 20,
                                    init() {
                                        this.$refs.inc.addEventListener('click', () => {
                                            this.width = this.width + 20
                                        })
                                    }
                                }
                            }
                        </script>
                    </td>
                </tr>

                <tr>
                    <td>Dispatch</td>
                    <td>
                        <div x-data="{ foo: 'bar' }" x-on:custom-event="foo = $event.detail.newValue">
                            <span x-text="foo"></span>

                            <button x-on:click="$dispatch('custom-event', {newValue: 'baz'})">Turn 'bar' to 'baz'</button>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>Cloak</td>
                    <td>
                        <div x-data="{}" x-cloak>
                            I'm cloaked
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
